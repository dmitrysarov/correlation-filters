# correlation-filters
Distortion invariant correlation filters (DIFs). Python realization
corFilter.py - provide correlation filter classes.
example.py - code example, consist of main classes methods

файлы https://drive.google.com/file/d/0Bx-V6vVAMn4rTlFCRXZqZGZIYmc/view


Задача: сравнить корреляционный метод детектирования лиц и каскадный детектор Хаара.
Условия: метод не обязан работать в режиме реального времени.
В связи с послабляющим условием в качестве корреляционного метода был выбран – квадратичный инвариантный корреляционный фильтр (QCF) [1]. 
В качестве анализируемой выборки данных был выбран набор http://hellosaumil.github.io/SEAS-FR/index.html

Из обучающей выборки видео (каждого человека, отдельно стоящего в кадре, папка train) с помощью каскадного детектора хаара была создана обучающая выборка фотографий для фильтра - эталонного (лицо) и ложного (фон – 12 000 изображений) классов для двух случаев – 1) алгоритм обучался на изображениях лица одного человека (400 изображений) 2) алгоритм обучался на изображениях лиц всех предложенных (троих) людей (1200 изображений). 

Далее было произведено тестирование алгоритма на тестовой выборке видео (папка test).
Анализ результата в случае одного «обучающего лица»

Файл one_face_rec_all_stand.avi алгоритм стабильно детектирует лицо человека, на котором был обучен. При этом файл one_face_rec_all_stand_crossCorrField.avi, на котором представлен вид кросс-корреляционного поля дает представление о результате взаимодействия алгоритма с лицами других людей. А именно, наблюдается четкие кросс-корреляционные пики, однако, их высота ниже выбранного порога. Стоит упомянуть, что при обучении фильтра лица других людей не использовались в качестве образцов ложного класса, поэтому их дискриминация не гарантируется, что и наблюдается во втором примере, файл one_face_rec_all_slide.avi (one_face_rec_all_slide_crossCorrField.avi). Также стоит упомянуть, что при детектировании не используется пирамида изображений, что выражается в чувствительности алгоритма к масштабу изображения (устойчивость к изменению масштаба в ~20%), таким образом, результат использования алгоритма деградирует при неверно выбранном масштабе, что демонстрирует файл one_face_rec_all_slide_weak_scale.avi (масштаб отличается в два раза). Из последнего видео становится понятным, что алгоритм реагирует на форму и размер носа, что выражается в четком детектировании лица человека с сильно отличающейся в размере этой частью лица.
Анализ результата в случае трех «обучающих лиц»

На видео thee_face_all_stand.avi и thee_face_all_slide.avi зеленым прямоугольником отображается результат алгоритма каскадного детектора Хаара, а красной точкой результат корреляционного метода. Отмечу, что фильтр распознает всех пятерых человек, не смотря на то, что в обучении участвовали лишь трое.

На примере видео thee_face_all_stand.avi были получены следующие результаты алгоритмов
Haar cascad 
Precision=1	Recall=0.99

QCF
Precision=1	Recall=0.96
Более низкое значение полноты связанно с пропуском фильтра лица правого человека (лицо которого не входило в обучающий набор), когда тот закрывает глаза. Сделаю акцент на том, что время обучения фильтра измеряется в минутах, в то время как время обучения каскада измеряется в днях (при условии одинаковых ПК). 

Дальнейшие пути улучшения алгоритма

В первую очередь алгоритм нуждается в ускорении, для этого можно использовать скользящее окно в жертву точности локализации объекта, также оптимизация возможно и за счет сокращения числа DTF проводимых алгоритмом. 
Расчет составных корреляций возможен в параллельном режиме, на нескольких ядрах.
Повышение точности алгоритма возможно посредством использования более «сложной» метрики оценивающей форму корреляционного пика, а не только его высоту.

[1] Abhijit Mahalanobis, Robert R. Muise, and S. Robert Stanfill, "Quadratic correlation filter design methodology for target detection and surveillance applications," Appl. Opt. 43, 5198-5205 (2004)
